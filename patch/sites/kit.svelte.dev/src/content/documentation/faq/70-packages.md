---
question: Как исправить ошибку, которая происходит при попытке импортировать пакеты?
---

<!-- Большинство проблем приходят из Vite, который пытается подключать пакеты не являющиеся ESM модулями. Вы можете посмотреть полезные примеры в [репозитории Vite](https://github.com/vitejs/vite/issues). Обычным решением проблемы может стать перемещение пакета между секциями `dependencies` и `devDependencies` или попытаться добавить или убрать его из опции `optimizeDeps`. Пакеты, которые используют `exports` вместо `module.exports` будут вызывать ошибку – это известная [проблема в Vite](https://github.com/vitejs/vite/issues/2579). Также вы можете попросить автоа пакета поставлять также ESM версию модуля или даже переписать пакет полностью на ES модули.

Также вы должны добавить все компоненты Svelte в параметр `ssr.noExternal`. [Надеемся в будущем это будет происходить автоматически](https://github.com/sveltejs/kit/issues/904) при нахождении поля `svelte` в файле `package.json` внутри пакета. -->

<!-- Большинство проблем приходят из Vite, который пытается подключать пакеты не являющиеся ESM модулями. Вы можете найти свое сообщение об ошибке в [трекере проблем Vite](https://github.com/vitejs/vite/issues). -->

Старые бета-версии шаблона SvelteKit включали значение конфигурации `noExternal: Object.keys (pkg.dependencies || {})` в `svelte.config.js`. Во-первых, проверьте, присутствует ли эта строка в вашем проекте, и удалите ее, если таковая имеется. Удаление этой строки устраняет большинство проблем, и с тех пор она была удалена из шаблона.

<!-- Наиболее распространенные решения - это переместить пакет из `dependencies` в `devDependencies` или попытаться `include` или `exclude` его в `optimizeDeps`. В настоящее время SvelteKit просит Vite собрать все ваши `dependencies` в общий бандл для упрощения развертывания в бессерверной среде. Но при перемещении зависимости в `devDependencies` Vite не будет собирать их в общий бандл. Это может решить проблемы, с которыми Vite сталкивается при попытке связать определенные библиотеки. Избегание связывания Vite особенно эффективно для `adapter-node` и `adapter-static`, где связывание не требуется, поскольку вы не работаете в бессерверной среде. Мы рассматриваем [лучшие альтернативы](https://github.com/sveltejs/kit/issues/1016), чтобы упростить эту настройку. -->

<!-- Существует ряд известных проблем с Vite, которые вызывают ошибки в следующих случаях:
- [Пакет использует `exports` вместо `module.exports`](https://github.com/vitejs/vite/issues/2579).
- [CommonJS пакеты в `noExternal`](https://github.com/vitejs/vite/issues/2579).
- [Компонент Svelte, который импортирует библиотеку CJS](https://github.com/vitejs/vite/issues/3024)
- [Некоторые библиотеки UMD](https://github.com/vitejs/vite/issues/2679) -->

> Имейте ввиду, что вы больше не сможете напрямую импортировать JSON файлы оператором request, т.к. SvelteKit ожидает, что [`svelte.config.js`](/docs#konfiguracziya) будет ES модулем. Вы можете загрузить JSON таким образом:
>
> ```js
> const pkg = JSON.parse(fs.readFileSync(new URL('package.json', import.meta.url), 'utf8'));
> ```


Вторая наиболее часто встречающаяся проблема - наличие компонента Svelte, импортирующего библиотеку CommonJS. В этом случае вам следует попытаться поработать с авторами библиотеки над публикацией ESM версии зависимости. Тем не менее, вы можете обойти эту проблему, добавив зависимость для `vite.optimizeDeps.include` в `svelte.config.js`.

<!-- Пакеты, которые используют `exports` вместо `module.exports`, в настоящее время не работают из-за [известной проблемы Vite](https://github.com/vitejs/vite/issues/2579). Вам также следует подумать о том, чтобы попросить автора библиотеки опубликовать версию своего пакета в ESM или даже преобразовать исходный код пакета полностью в ESM. -->

<!-- Vite 2 - относительно новая библиотека, и мы ожидаем, что со временем станет проще использовать библиотеки, не относящиеся к ESM, с Vite. Однако можно попросить автора библиотеки опубликовать версию своего пакета в формате ESM или даже полностью преобразовать исходный код пакета в ESM. ESM теперь является стандартным способом написания библиотек JavaScript, и, хотя существует множество устаревших пакетов, работать с экосистемой станет намного проще, поскольку все больше библиотек конвертируются в ESM. -->

<!-- Наиболее распространенные решения - это переместить пакет из `dependencies` в `devDependencies` или попытаться `include` или `exclude` его в `optimizeDeps`. В настоящее время SvelteKit просит Vite собрать все `dependencies` в общий бандл для упрощения развертывания в бессерверной среде. Но при перемещении зависимости в `devDependencies` Vite не будет собирать их в общий бандл. Это может решить проблемы, с которыми Vite сталкивается при попытке связать определенные библиотеки. Избегание связывания Vite особенно эффективно для `adapter-node` и `adapter-static`, где связывание не требуется, поскольку не работает в бессерверной среде. Мы рассматриваем [лучшие альтернативы](https://github.com/sveltejs/kit/issues/1016), чтобы упростить эту настройку. Также следует добавить любые компоненты Svelte в `ssr.noExternal`. [Мы надеемся сделать это автоматическим в будущем](https://github.com/sveltejs/kit/issues/904). -->

<!-- Наиболее распространенные обходные пути - `include` или `exclude` проблемный пакет в [`optimizeDeps`](https://vitejs.dev/config/#dep-optimization-options) или добавить его в [`ssr.external` или `ssr.noExternal`](https://vitejs.dev/config/#ssr-options). -->

Наконец, в Vite были исправлены некоторые проблемы, поэтому мы рекомендуем перейти на последнюю версию Vite. Если вы все еще сталкиваетесь с проблемами, мы рекомендуем поискать их в [трекере проблем Vite](https://github.com/vitejs/vite/issues), или в трекере проблем соответствующей библиотеки. Иногда проблемы можно обойти, возясь со значениями конфигурации [`optimizeDeps`](https://vitejs.dev/config/#dep-optimization-options) или [`ssr`](https://vitejs.dev/config/#ssr-options).